# Androidæƒé™ç®¡ç†é¢è¯•é¢˜

æœ¬ç« èŠ‚åŒ…å«Androidæƒé™ç®¡ç†ç›¸å…³çš„é¢è¯•é¢˜ï¼Œæ¶µç›–æƒé™åˆ†ç±»ã€è¿è¡Œæ—¶æƒé™ã€æƒé™ç”³è¯·æµç¨‹ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚

## åŸºç¡€æ¦‚å¿µ

### ğŸ”¥ é€‰æ‹©é¢˜1ï¼šAndroidæƒé™åˆ†ç±»

å…³äºAndroidæƒé™åˆ†ç±»ï¼Œä»¥ä¸‹è¯´æ³•é”™è¯¯çš„æ˜¯ï¼š

A. æ™®é€šæƒé™ä¸éœ€è¦ç”¨æˆ·æ˜ç¡®æˆäºˆï¼Œå®‰è£…æ—¶ä¼šè‡ªåŠ¨æ‰¹å‡†
B. å±é™©æƒé™å¿…é¡»ç”±ç”¨æˆ·æ˜ç¡®æˆäºˆï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ç”³è¯·
C. ç‰¹æ®Šæƒé™åªèƒ½é€šè¿‡ç³»ç»Ÿè®¾ç½®ç•Œé¢æˆäºˆ
D. æ‰€æœ‰æƒé™éƒ½éœ€è¦åœ¨AndroidManifest.xmlä¸­å£°æ˜åæ‰èƒ½ä½¿ç”¨

<details>
<summary>ç­”æ¡ˆä¸è§£æ</summary>

**ç­”æ¡ˆï¼šD**

è§£æï¼š
1. æ™®é€šæƒé™ï¼ˆNormal Permissionsï¼‰ç¡®å®åœ¨å®‰è£…æ—¶è‡ªåŠ¨æˆäºˆï¼Œæ— éœ€ç”¨æˆ·ç¡®è®¤
2. å±é™©æƒé™ï¼ˆDangerous Permissionsï¼‰éœ€è¦ç”¨æˆ·æ˜ç¡®æˆæƒï¼Œå¯ä»¥ä½¿ç”¨è¿è¡Œæ—¶æƒé™æœºåˆ¶ç”³è¯·
3. ç‰¹æ®Šæƒé™ï¼ˆSpecial Permissionsï¼‰å¦‚SYSTEM_ALERT_WINDOWï¼Œç¡®å®éœ€è¦é€šè¿‡ç³»ç»Ÿè®¾ç½®æˆäºˆ
4. åŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨å¯ä»¥ä¸åœ¨AndroidManifest.xmlä¸­å£°æ˜æƒé™ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨
</details>

### ğŸ”¥ é—®ç­”é¢˜1ï¼šè¿è¡Œæ—¶æƒé™æœºåˆ¶

**é—®é¢˜ï¼šè¯·è¯¦ç»†è¯´æ˜Android 6.0å¼•å…¥çš„è¿è¡Œæ—¶æƒé™æœºåˆ¶çš„å·¥ä½œåŸç†å’Œæœ€ä½³å®è·µã€‚**

<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>

1. **è¿è¡Œæ—¶æƒé™æœºåˆ¶åŸç†**
   - Android 6.0ï¼ˆAPI 23ï¼‰å¼€å§‹å¼•å…¥
   - å°†å±é™©æƒé™çš„æˆæƒæ—¶æœºä»å®‰è£…æ—¶æ”¹ä¸ºè¿è¡Œæ—¶
   - ç”¨æˆ·å¯ä»¥éšæ—¶æ’¤é”€å·²æˆäºˆçš„æƒé™
   - æƒé™åˆ†ç»„ç®¡ç†ï¼ŒåŒç»„æƒé™ä¸€èµ·æˆäºˆ

2. **æƒé™ç”³è¯·æµç¨‹**
   - æ£€æŸ¥æ˜¯å¦å·²æœ‰æƒé™
   - å¦‚æœæ²¡æœ‰ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒ
   - å¤„ç†ç”¨æˆ·æˆæƒç»“æœ
   - æ ¹æ®æˆæƒç»“æœæ‰§è¡Œç›¸åº”æ“ä½œ

3. **æœ€ä½³å®è·µ**
   - åœ¨ä½¿ç”¨åŠŸèƒ½å‰æ£€æŸ¥å’Œç”³è¯·æƒé™
   - è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¿™äº›æƒé™
   - ä¼˜é›…å¤„ç†æƒé™è¢«æ‹’ç»çš„æƒ…å†µ
   - è€ƒè™‘æƒé™è¢«æ°¸ä¹…æ‹’ç»çš„åœºæ™¯

4. **æ³¨æ„äº‹é¡¹**
   - ä¸è¦ä¸€æ¬¡æ€§è¯·æ±‚è¿‡å¤šæƒé™
   - æä¾›é™çº§åŠŸèƒ½é€‰é¡¹
   - éµå¾ªæœ€å°æƒé™åŸåˆ™
   - åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æƒé™
</details>

### ğŸ”¥ ç¼–ç¨‹é¢˜ï¼šæƒé™ç®¡ç†å·¥å…·ç±»

**é—®é¢˜ï¼šå®ç°ä¸€ä¸ªæƒé™ç®¡ç†å·¥å…·ç±»ï¼ŒåŒ…å«æƒé™æ£€æŸ¥ã€ç”³è¯·ã€ç»“æœå¤„ç†ç­‰åŠŸèƒ½ã€‚**

<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>

```java
public class PermissionHelper {
    private Activity activity;
    private static final int PERMISSION_REQUEST_CODE = 100;
    private PermissionCallback callback;
    
    public interface PermissionCallback {
        void onPermissionGranted();
        void onPermissionDenied(List<String> deniedPermissions);
    }
    
    public PermissionHelper(Activity activity) {
        this.activity = activity;
    }
    
    // æ£€æŸ¥å•ä¸ªæƒé™
    public boolean hasPermission(String permission) {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            return activity.checkSelfPermission(permission) 
                == PackageManager.PERMISSION_GRANTED;
        }
        return true;
    }
    
    // æ£€æŸ¥å¤šä¸ªæƒé™
    public boolean hasPermissions(String[] permissions) {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            for (String permission : permissions) {
                if (activity.checkSelfPermission(permission) 
                    != PackageManager.PERMISSION_GRANTED) {
                    return false;
                }
            }
        }
        return true;
    }
    
    // è¯·æ±‚æƒé™
    public void requestPermissions(String[] permissions, PermissionCallback callback) {
        this.callback = callback;
        
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            List<String> permissionsToRequest = new ArrayList<>();
            
            for (String permission : permissions) {
                if (activity.checkSelfPermission(permission) 
                    != PackageManager.PERMISSION_GRANTED) {
                    permissionsToRequest.add(permission);
                }
            }
            
            if (permissionsToRequest.isEmpty()) {
                callback.onPermissionGranted();
            } else {
                activity.requestPermissions(
                    permissionsToRequest.toArray(new String[0]),
                    PERMISSION_REQUEST_CODE
                );
            }
        } else {
            callback.onPermissionGranted();
        }
    }
    
    // å¤„ç†æƒé™è¯·æ±‚ç»“æœ
    public void onRequestPermissionsResult(int requestCode,
                                         String[] permissions,
                                         int[] grantResults) {
        if (requestCode == PERMISSION_REQUEST_CODE) {
            List<String> deniedPermissions = new ArrayList<>();
            
            for (int i = 0; i < permissions.length; i++) {
                if (grantResults[i] != PackageManager.PERMISSION_GRANTED) {
                    deniedPermissions.add(permissions[i]);
                }
            }
            
            if (deniedPermissions.isEmpty()) {
                if (callback != null) {
                    callback.onPermissionGranted();
                }
            } else {
                if (callback != null) {
                    callback.onPermissionDenied(deniedPermissions);
                }
            }
        }
    }
    
    // æ£€æŸ¥æƒé™æ˜¯å¦è¢«æ°¸ä¹…æ‹’ç»
    public boolean isPermissionPermanentlyDenied(String permission) {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
            return !activity.shouldShowRequestPermissionRationale(permission) &&
                   activity.checkSelfPermission(permission) == 
                   PackageManager.PERMISSION_DENIED;
        }
        return false;
    }
    
    // æ‰“å¼€åº”ç”¨è®¾ç½®ç•Œé¢
    public void openAppSettings() {
        Intent intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
        Uri uri = Uri.fromParts("package", activity.getPackageName(), null);
        intent.setData(uri);
        activity.startActivity(intent);
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public void requestCameraPermission() {
        String[] permissions = {Manifest.permission.CAMERA};
        
        requestPermissions(permissions, new PermissionCallback() {
            @Override
            public void onPermissionGranted() {
                // æƒé™å·²æˆäºˆï¼Œæ‰§è¡Œç›¸æœºç›¸å…³æ“ä½œ
                startCamera();
            }
            
            @Override
            public void onPermissionDenied(List<String> deniedPermissions) {
                // æƒé™è¢«æ‹’ç»
                if (isPermissionPermanentlyDenied(Manifest.permission.CAMERA)) {
                    // æ˜¾ç¤ºå¯¹è¯æ¡†å¼•å¯¼ç”¨æˆ·å»è®¾ç½®ç•Œé¢å¼€å¯æƒé™
                    showSettingsDialog();
                } else {
                    // æ˜¾ç¤ºæƒé™ç”¨é€”è¯´æ˜
                    showPermissionRationale();
                }
            }
        });
    }
}
```

ä»£ç è¯´æ˜ï¼š
1. å®ç°äº†å®Œæ•´çš„æƒé™ç®¡ç†åŠŸèƒ½ï¼š
   - æƒé™æ£€æŸ¥
   - æƒé™è¯·æ±‚
   - ç»“æœå¤„ç†
   - æ°¸ä¹…æ‹’ç»æ£€æŸ¥
2. ä½¿ç”¨å›è°ƒæ¥å£å¤„ç†æƒé™ç»“æœ
3. æ”¯æŒå•ä¸ªå’Œå¤šä¸ªæƒé™çš„è¯·æ±‚
4. åŒ…å«ç‰ˆæœ¬é€‚é…ä»£ç 
5. æä¾›äº†å®ç”¨çš„è¾…åŠ©æ–¹æ³•
6. åŒ…å«å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
</details>