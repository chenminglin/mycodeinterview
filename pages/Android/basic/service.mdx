# Serviceç›¸å…³é¢è¯•é¢˜

æœ¬ç« èŠ‚åŒ…å«Android Serviceç»„ä»¶ç›¸å…³çš„é¢è¯•é¢˜ï¼Œæ¶µç›–Serviceçš„ç”Ÿå‘½å‘¨æœŸã€å¯åŠ¨æ–¹å¼ã€å‰å°Serviceç­‰é‡è¦æ¦‚å¿µã€‚

## ServiceåŸºç¡€

### ğŸ”¥ é€‰æ‹©é¢˜1ï¼šServiceçš„å¯åŠ¨æ–¹å¼

å…³äºServiceçš„å¯åŠ¨æ–¹å¼ï¼Œä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼š

A. startService()å¯åŠ¨çš„Serviceä¸è°ƒç”¨è€…ç”Ÿå‘½å‘¨æœŸç»‘å®š
B. bindService()å¯åŠ¨çš„Serviceåœ¨æ‰€æœ‰ç»‘å®šç»„ä»¶è§£ç»‘åä¼šè‡ªåŠ¨åœæ­¢
C. åŒä¸€ä¸ªServiceå¯ä»¥æ—¢è¢«startService()å¯åŠ¨åˆè¢«bindService()ç»‘å®š
D. bindService()æ–¹æ³•ä¼šç«‹å³è¿”å›Serviceå®ä¾‹

<details>
<summary>ç­”æ¡ˆä¸è§£æ</summary>

**ç­”æ¡ˆï¼šBã€C**

è§£æï¼š
1. startService()å¯åŠ¨çš„Serviceç‹¬ç«‹äºå¯åŠ¨å®ƒçš„ç»„ä»¶ï¼Œå³ä½¿å¯åŠ¨å®ƒçš„ç»„ä»¶è¢«é”€æ¯ï¼ŒServiceä»ç„¶ä¼šç»§ç»­è¿è¡Œï¼Œç›´åˆ°è°ƒç”¨stopService()æˆ–è‡ªèº«è°ƒç”¨stopSelf()
2. bindService()å¯åŠ¨çš„Serviceç¡®å®ä¼šåœ¨æ‰€æœ‰ç»‘å®šç»„ä»¶éƒ½è§£ç»‘ï¼ˆunbindServiceï¼‰åè‡ªåŠ¨åœæ­¢
3. ä¸€ä¸ªServiceå¯ä»¥åŒæ—¶æ”¯æŒä¸¤ç§å¯åŠ¨æ–¹å¼
4. bindService()æ˜¯å¼‚æ­¥çš„ï¼ŒServiceå®ä¾‹é€šè¿‡ServiceConnectionå›è°ƒè·å–
</details>

### ğŸ”¥ é—®ç­”é¢˜1ï¼šServiceç”Ÿå‘½å‘¨æœŸ

**é—®é¢˜ï¼šè¯·è¯¦ç»†æè¿°Serviceçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬ä¸¤ç§å¯åŠ¨æ–¹å¼ä¸‹çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è°ƒç”¨é¡ºåºã€‚**

<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>

Serviceçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸»è¦åŒ…æ‹¬ï¼š

1. **startService()æ–¹å¼ï¼š**
   - onCreate() â†’ onStartCommand() â†’ onDestroy()
   - onCreate()åªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºServiceæ—¶è°ƒç”¨
   - å¤šæ¬¡è°ƒç”¨startService()åªä¼šè§¦å‘onStartCommand()
   - stopService()æ—¶ç›´æ¥è°ƒç”¨onDestroy()

2. **bindService()æ–¹å¼ï¼š**
   - onCreate() â†’ onBind() â†’ onUnbind() â†’ onDestroy()
   - onCreate()åªåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºServiceæ—¶è°ƒç”¨
   - onBind()åªåœ¨ç¬¬ä¸€æ¬¡ç»‘å®šæ—¶è°ƒç”¨
   - onUnbind()åœ¨æ‰€æœ‰ç»„ä»¶éƒ½è§£ç»‘æ—¶è°ƒç”¨

3. **ç‰¹æ®Šæƒ…å†µï¼š**
   - å¦‚æœServiceåŒæ—¶è¢«startå’Œbindï¼Œåˆ™éœ€è¦åŒæ—¶è°ƒç”¨stopService()å’ŒunbindService()æ‰ä¼šé”€æ¯
   - ç³»ç»Ÿèµ„æºä¸è¶³æ—¶å¯èƒ½ä¼šé”€æ¯Serviceï¼Œæ­¤æ—¶ä¼šè°ƒç”¨onTrimMemory()
</details>

### ğŸ”¥ é—®ç­”é¢˜2ï¼šå‰å°Service

**é—®é¢˜ï¼šä»€ä¹ˆæ˜¯å‰å°Serviceï¼Ÿå¦‚ä½•åˆ›å»ºå‰å°Serviceï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å‰å°Serviceï¼Ÿ**

<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>

1. **å‰å°Serviceå®šä¹‰ï¼š**
   - å‰å°Serviceæ˜¯ä¸€ç§ç‰¹æ®Šçš„Serviceï¼Œå®ƒä¼šåœ¨é€šçŸ¥æ æ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥
   - å®ƒå…·æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œä¸å®¹æ˜“è¢«ç³»ç»Ÿå›æ”¶

2. **åˆ›å»ºæ–¹æ³•ï¼š**
```java
Notification notification = new NotificationCompat.Builder(this, CHANNEL_ID)
    .setContentTitle("å‰å°æœåŠ¡è¿è¡Œä¸­")
    .setContentText("ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…")
    .setSmallIcon(R.drawable.ic_notification)
    .build();

startForeground(NOTIFICATION_ID, notification);
```

3. **ä½¿ç”¨åœºæ™¯ï¼š**
   - éŸ³ä¹æ’­æ”¾å™¨
   - æ–‡ä»¶ä¸‹è½½
   - ä½ç½®è¿½è¸ª
   - å³æ—¶é€šè®¯

4. **ä½¿ç”¨åŸå› ï¼š**
   - é˜²æ­¢Serviceè¢«ç³»ç»Ÿå›æ”¶
   - å‘ŠçŸ¥ç”¨æˆ·åå°ä»»åŠ¡æ­£åœ¨è¿è¡Œ
   - ç¬¦åˆAndroid 8.0+å¯¹åå°æœåŠ¡çš„é™åˆ¶è¦æ±‚
   - æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
</details>

### ğŸ”¥ ç¼–ç¨‹é¢˜ï¼šIntentServiceçš„å®ç°

**é—®é¢˜ï¼šè¯·å®ç°ä¸€ä¸ªä½¿ç”¨IntentServiceå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç¤ºä¾‹ï¼Œè¦æ±‚åŒ…å«ä»»åŠ¡é˜Ÿåˆ—å¤„ç†å’Œç»“æœå›è°ƒã€‚**

<details>
<summary>å‚è€ƒç­”æ¡ˆ</summary>

```java
public class DownloadService extends IntentService {
    public static final String ACTION_DOWNLOAD = "com.example.action.DOWNLOAD";
    public static final String EXTRA_URL = "com.example.extra.URL";
    public static final String BROADCAST_ACTION = "com.example.broadcast.DOWNLOAD_RESULT";

    public DownloadService() {
        super("DownloadService");
    }

    @Override
    protected void onHandleIntent(Intent intent) {
        if (intent != null) {
            final String action = intent.getAction();
            if (ACTION_DOWNLOAD.equals(action)) {
                final String url = intent.getStringExtra(EXTRA_URL);
                handleDownload(url);
            }
        }
    }

    private void handleDownload(String url) {
        // æ¨¡æ‹Ÿä¸‹è½½è¿‡ç¨‹
        try {
            Thread.sleep(2000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            // å‘é€å¹¿æ’­é€šçŸ¥ä¸‹è½½å®Œæˆ
            Intent broadcastIntent = new Intent(BROADCAST_ACTION);
            broadcastIntent.putExtra("result", "Download completed: " + url);
            sendBroadcast(broadcastIntent);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class MainActivity extends AppCompatActivity {
    private BroadcastReceiver receiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            String result = intent.getStringExtra("result");
            Toast.makeText(context, result, Toast.LENGTH_SHORT).show();
        }
    };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        
        // æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨
        registerReceiver(receiver, new IntentFilter(DownloadService.BROADCAST_ACTION));
        
        // å¯åŠ¨æœåŠ¡
        Intent intent = new Intent(this, DownloadService.class);
        intent.setAction(DownloadService.ACTION_DOWNLOAD);
        intent.putExtra(DownloadService.EXTRA_URL, "https://example.com/file.pdf");
        startService(intent);
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        unregisterReceiver(receiver);
    }
}
```

ä»£ç è¯´æ˜ï¼š
1. åˆ›å»ºè‡ªå®šä¹‰IntentServiceç±»å¤„ç†ä¸‹è½½ä»»åŠ¡
2. ä½¿ç”¨å¹¿æ’­é€šçŸ¥ä¸‹è½½ç»“æœ
3. åœ¨Activityä¸­æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ¥æ”¶ç»“æœ
4. é€šè¿‡Intentä¼ é€’ä¸‹è½½å‚æ•°
5. ç¡®ä¿åœ¨Activityé”€æ¯æ—¶æ³¨é”€å¹¿æ’­æ¥æ”¶å™¨
</details>