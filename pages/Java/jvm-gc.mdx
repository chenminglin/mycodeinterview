# JVM垃圾回收机制

## 垃圾回收基础

### 1. 如何判断对象是否可以被回收？

```plaintext
问：Java中如何判断一个对象是否可以被垃圾回收？有哪些算法？

答：判断对象是否可回收的主要算法：

1. 引用计数法
   - 给对象添加引用计数器
   - 每被引用一次计数加1
   - 每失去引用计数减1
   - 计数为0时可回收
   - 缺点：无法解决循环引用问题

2. 可达性分析算法
   - 从GC Roots开始搜索
   - 不可达的对象标记为可回收
   - GC Roots包括：
     * 虚拟机栈中引用的对象
     * 方法区中静态属性引用的对象
     * 方法区中常量引用的对象
     * 本地方法栈中JNI引用的对象
```

### 2. Java中的引用类型

```plaintext
问：Java中有哪些引用类型？它们的区别是什么？

答：Java提供四种引用类型：

1. 强引用（Strong Reference）
   - 最普遍的引用类型
   - 只要强引用存在，对象就不会被回收
   - new操作符创建的引用

2. 软引用（Soft Reference）
   - 内存不足时会被回收
   - 用于实现内存敏感的高速缓存

3. 弱引用（Weak Reference）
   - 下一次GC时会被回收
   - 用于避免内存泄漏

4. 虚引用（Phantom Reference）
   - 不会影响对象的生命周期
   - 用于跟踪对象被垃圾回收的状态
```

## 垃圾收集器

### 1. 常见的垃圾收集器

```plaintext
问：JVM中有哪些垃圾收集器？它们的特点是什么？

答：主要的垃圾收集器：

1. Serial收集器
   - 单线程收集器
   - 简单高效
   - 适合单CPU环境

2. ParNew收集器
   - Serial的多线程版本
   - 适合多CPU环境
   - 常与CMS配合使用

3. Parallel Scavenge收集器
   - 注重吞吐量
   - 可控制的吞吐量
   - 适合后台运算

4. CMS收集器
   - 最短回收停顿时间
   - 并发收集
   - 适合互联网应用

5. G1收集器
   - 面向服务端应用
   - 可预测的停顿时间
   - 区域化分代式
```

### 2. 垃圾收集器参数调优

```plaintext
问：如何通过参数调优垃圾收集器的性能？

答：垃圾收集器调优参数：

1. 收集器选择
   - -XX:+UseSerialGC：串行收集器
   - -XX:+UseParallelGC：并行收集器
   - -XX:+UseConcMarkSweepGC：CMS收集器
   - -XX:+UseG1GC：G1收集器

2. 内存分配
   - -Xms：初始堆大小
   - -Xmx：最大堆大小
   - -Xmn：新生代大小
   - -XX:SurvivorRatio：Eden/Survivor比例

3. GC日志
   - -XX:+PrintGCDetails：打印GC详细信息
   - -XX:+PrintGCDateStamps：打印GC时间戳
   - -Xloggc:filename：GC日志文件
```

## GC调优实践

### 1. GC调优目标

1. **降低GC频率**
   - 合理的堆内存大小
   - 优化对象生命周期
   - 减少临时对象

2. **减少GC停顿时间**
   - 选择合适的收集器
   - 合理的内存分配
   - 控制对象进入老年代

### 2. 调优步骤

1. **分析GC日志**
   - 查看GC频率
   - 分析停顿时间
   - 观察内存使用趋势

2. **调整参数**
   - 修改内存分配
   - 调整收集器策略
   - 优化收集器参数

3. **验证效果**
   - 对比调优前后指标
   - 压力测试验证
   - 长期监控